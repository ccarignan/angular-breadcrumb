/*! angular-breadcrumb - v0.4.1-dev-2016-04-29
* http://ncuillery.github.io/angular-breadcrumb
* Copyright (c) 2016 Nicolas Cuillery; Licensed MIT */
!function(a,b,c){"use strict";function d(a){var b=a.replace(/\n/g," ").match(/^([^(]+?)\s*(\((.*)\))?$/);if(!b||4!==b.length)throw new Error("Invalid state ref '"+a+"'");return{state:b[1],paramExpr:b[3]||null}}function e(a){var b=0;for(var c in a)a.hasOwnProperty(c)&&b++;return b}function f(a,b,d,e){var f=k[a];f!==c&&f(),f=b.$on(d,e),k[a]=f}function g(){var a={prefixStateName:null,template:"bootstrap3",templateUrl:null,templateLast:"default",templateLastUrl:null,includeAbstract:!1};this.setOptions=function(c){b.extend(a,c)},this.$get=["$state","$stateParams","$rootScope",function(f,g,h){function i(){var a=f.$current,b=e(a.views);if(b){if(a.ncyBreadcrumb&&a.ncyBreadcrumb.mainView)return a.locals[a.ncyBreadcrumb.mainView];if(1===b){for(var c in a.views)if(a.views.hasOwnProperty(c))return a.locals[c]}else if(a.views["@"])return a.locals["@"];throw new Error("Multiple views found and mainView was not defined")}}function j(){var a=i();return a?a.$scope||h:h}var k=function(a){var b=a.parent||(/^(.+)\.[^.]+$/.exec(a.name)||[])[1],c="object"==typeof b;return c?b.name:b},l=function(c,e){var h,i,k=d(e),l=!1,m=!1;h=b.copy(f.get(k.state)),h.ncyBreadcrumb&&(h.ncyBreadcrumb.force&&(l=!0),h.ncyBreadcrumb.skip&&(m=!0)),h["abstract"]&&!a.includeAbstract&&!l||m||(k.paramExpr&&(i=j().$eval(k.paramExpr)),h.ncyBreadcrumbLink=f.href(k.state,i||g||{}),h.ncyBreadcrumbStateRef=e,c.unshift(h))},m=function(a){var b=d(a),c=f.get(b.state);if(c.ncyBreadcrumb&&c.ncyBreadcrumb.parent){var e="function"==typeof c.ncyBreadcrumb.parent,g=e?c.ncyBreadcrumb.parent(j()):c.ncyBreadcrumb.parent;if(g)return g}return k(c)};return{getTemplate:function(b){return a.templateUrl?null:b[a.template]?b[a.template]:a.template},getTemplateUrl:function(){return a.templateUrl},getTemplateLast:function(b){return a.templateLastUrl?null:b[a.templateLast]?b[a.templateLast]:a.templateLast},getTemplateLastUrl:function(){return a.templateLastUrl},getStatesChain:function(b){for(var c=[],d=f.$current.self.name;d;d=m(d))if(l(c,d),b&&c.length)return c;return!a.prefixStateName||c.length&&a.prefixStateName===c[0].name||l(c,a.prefixStateName),c},getLastStep:function(){var a=this.getStatesChain(!0);return a.length?a[0]:c},$getLastViewScope:j,$getLastViewLocals:i}}]}function h(a,c,d,e,g){var h={bootstrap2:'<ul class="breadcrumb"><li ng-repeat="step in steps" ng-switch="$last || !!step.abstract" ng-class="{active: $last}"><a ng-switch-when="false" href="{{step.ncyBreadcrumbLink}}">{{step.ncyBreadcrumbLabel}}</a><span ng-switch-when="true">{{step.ncyBreadcrumbLabel}}</span><span class="divider" ng-hide="$last">/</span></li></ul>',bootstrap3:'<ol class="breadcrumb"><li ng-repeat="step in steps" ng-class="{active: $last}" ng-switch="$last || !!step.abstract"><a ng-switch-when="false" href="{{step.ncyBreadcrumbLink}}">{{step.ncyBreadcrumbLabel}}</a><span ng-switch-when="true">{{step.ncyBreadcrumbLabel}}</span></li></ol>'};return{restrict:"AE",replace:!0,scope:{},template:c.getTemplate(h),templateUrl:c.getTemplateUrl(),link:{post:function(h){var i=[],j=function(){n(i),i=[];var d=c.$getLastViewScope(),f=c.$getLastViewLocals();h.steps=c.getStatesChain(),b.forEach(h.steps,function(b){if(b.ncyBreadcrumb&&b.ncyBreadcrumb.label){var c=Object.prototype.toString.call(b.ncyBreadcrumb.label);if("[object Function]"===c||"[object Array]"===c)g.when(e.invoke(b.ncyBreadcrumb.label,null,f)).then(function(a){b.ncyBreadcrumbLabel=a});else{var h=a(b.ncyBreadcrumb.label);b.ncyBreadcrumbLabel=h(d),m(i,h,d,b)}}else b.ncyBreadcrumbLabel=b.name})};f("BreadcrumbDirective.$viewContentLoaded",d,"$viewContentLoaded",function(){j()}),j()}}}}function i(a,b,c,d,e){var g={"default":"{{ncyBreadcrumbLabel}}"};return{restrict:"A",scope:{},template:b.getTemplateLast(g),templateUrl:b.getTemplateLastUrl(),compile:function(g,h){var i=g.attr(h.$attr.ncyBreadcrumbLast);return i&&g.html(i),{post:function(g){var h=[],i=function(){n(h),h=[];var c=b.$getLastViewScope(),f=b.$getLastViewLocals(),i=b.getLastStep();if(i)if(g.ncyBreadcrumbLink=i.ncyBreadcrumbLink,i.ncyBreadcrumb&&i.ncyBreadcrumb.label){var j=Object.prototype.toString.call(i.ncyBreadcrumb.label);if("[object Function]"===j||"[object Array]"===j)e.when(d.invoke(i.ncyBreadcrumb.label,null,f)).then(function(a){g.ncyBreadcrumbLabel=a});else{var k=a(i.ncyBreadcrumb.label);g.ncyBreadcrumbLabel=k(c),m(h,k,c,g)}}else g.ncyBreadcrumbLabel=i.name};f("BreadcrumbLastDirective.$viewContentLoaded",c,"$viewContentLoaded",function(){i()}),i()}}}}}function j(a,c,d,e,g){return{restrict:"A",scope:{},template:"{{ncyBreadcrumbChain}}",compile:function(h,i){var j=h.attr(i.$attr.ncyBreadcrumbText);j&&h.html(j);var k=h.attr(i.$attr.ncyBreadcrumbTextSeparator)||" / ";return{post:function(h){var i=[],j=function(a,c,d){b.forEach(l(c),function(b){var c=d.$watch(b,function(a,b){a!==b&&m()});a.push(c)})},m=function(){n(i),i=[];var d=c.$getLastViewScope(),f=c.$getLastViewLocals(),l=c.getStatesChain(),m=[];b.forEach(l,function(b){if(b.ncyBreadcrumb&&b.ncyBreadcrumb.label){var c=Object.prototype.toString.call(b.ncyBreadcrumb.label);if("[object Function]"===c||"[object Array]"===c)m.push(g.when(e.invoke(b.ncyBreadcrumb.label,null,f)));else{var h=a(b.ncyBreadcrumb.label);m.push(g.when(h(d))),j(i,h,d)}}else m.push(g.when(b.name))}),h.ncyBreadcrumbChain=[],g.all(m).then(function(a){h.ncyBreadcrumbChain=a.join(k)})};f("BreadcrumbTextDirective.$viewContentLoaded",d,"$viewContentLoaded",function(){m()}),m()}}}}}var k={},l=function(a){if(a.expressions)return a.expressions;var c=[];return b.forEach(a.parts,function(a){b.isFunction(a)&&c.push(a.exp)}),c},m=function(a,c,d,e){b.forEach(l(c),function(b){var f=d.$watch(b,function(){e.ncyBreadcrumbLabel=c(d)});a.push(f)})},n=function(a){b.forEach(a,function(a){a()})};h.$inject=["$interpolate","$breadcrumb","$rootScope","$injector","$q"],i.$inject=["$interpolate","$breadcrumb","$rootScope","$injector","$q"],j.$inject=["$interpolate","$breadcrumb","$rootScope","$injector","$q"],b.module("ncy-angular-breadcrumb",["ui.router.state"]).provider("$breadcrumb",g).directive("ncyBreadcrumb",h).directive("ncyBreadcrumbLast",i).directive("ncyBreadcrumbText",j)}(window,window.angular);